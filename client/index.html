<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title><?= data.title ?></title>

    <!-- Include Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Include Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Include CSS -->
    <?!= include('client/style.html'); ?>

    <!-- Include ALL core JavaScript regardless of login state -->
    <?!= include('client/main.html'); ?>
    <?!= include('client/auth.html'); ?>
    <?!= include('client/flashcards.html'); ?>

    <!-- Include admin JavaScript if user is admin -->
    <? if (data.isAdmin) { ?>
      <?!= include('client/admin.html'); ?>
      <?!= include('client/dictionary.html'); ?>
    <? } ?>
  </head>
  <body>
    <div class="app-container">
      <header class="app-header">
        <div class="app-title">
          <h1>Flashcard App</h1>
        </div>
        <div class="user-info" id="userInfo" style="display: <?= data.isLoggedIn ? 'flex' : 'none' ?>;">
          <span>Welcome, <?= data.userName ?></span>
          <button id="logoutBtn" class="btn-text">Logout</button>
          <? if (data.isAdmin) { ?>
          <button id="adminPanelBtn" class="btn-text">Admin Panel</button>
          <? } ?>
        </div>
      </header>

      <main class="app-content" id="appContent">
        <!-- Content will be loaded here -->
        <div id="loadingIndicator" class="loading-indicator">
          <div class="spinner"></div>
          <p>Loading...</p>
        </div>
      </main>

      <footer class="app-footer">
        <p>Â© 2025 Flashcard App</p>
      </footer>
    </div>

    <!-- Initialize App -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Initialize the app
        initApp({
          isLoggedIn: <?= Boolean(data.isLoggedIn) ? 'true' : 'false' ?>,
          isAdmin: <?= Boolean(data.isAdmin) ? 'true' : 'false' ?>,
          userName: "<?= data.userName || '' ?>",
          initialPage: '<?= data.page ?>'
        });
      });
    </script>

    <!-- Include all partial templates -->
    <?!= include('partials/login.html'); ?>
    <?!= include('partials/flashcardView.html'); ?>
    <?!= include('partials/deckList.html'); ?>
    <? if (data.isAdmin) { ?>
      <?!= include('partials/adminPanel.html'); ?>
      <?!= include('partials/dictionaryLookup.html'); ?>
    <? } ?>
  </body>
</html>